# CONTA-LA - Contador de latas - Tutorial V.0.1 



| Projeto: CONTA-LA  Contador de Latas  |
| ------------------------------------- |
| Autor: Matheus Lucas de Souza Andrade |
| Versão: 2.1.1 - Hybrid system Pilot   |
| Local: Cervejaria Águas da Serra      |



---

**Materiais necessários**

- KIT RASPBERRY PI 4 MODEL B 8GB RAM
  - CARTÃO DE MEMÓRIA 64GB CLASSE A1
  - CASE DE PROTEÇÃO
  - FONTE DE ALIMENTAÇÃO
  - CABO MICRO-HDMI PARA HDMI
- WEBCAM LOGITECH C920 PRO
- EXTENSOR USB 3.0 3 METROS
- CABO DE REDE ETHERNET (SE FOR UTILIZAR COMUNICAÇÃO CLP)

---



**Instalação SO**

---

- CERTIFICAR QUE O COMPUTADOR TENHA ENTRADA ADAPTADOR DE LEITOR DE CARTÃO MEMÓRIA SD OU LEITOR EXTERNO.
- INSTALAR O SOFTWARE DE INSTALAÇÃO DE IMAGENS **"Raspberry Pi Imager"**
  - https://bit.ly/RaspberryPiImager
- REALIZAR O DOWNLOAD DA IMAGEM DO "**CONTA-LA**"
  - https://bit.ly/ImagemConta-la
- INSTALANDO O SISTEMA OPERACIONAL NO CARTÃO DE MEMÓRIA
  - ABRIR O SOFTWARE **"Raspberry Pi Imager"**
    - CHOOSE OS
      - USE CUSTOM
      - SELECIONE A IMAGEM DO RASPBERRY BAIXADO NO COMENTÁRIO ANTERIOR
    - CHOOSE STORAGE
      - SELECIONE O CARTÃO DE MEMÓRIA
    - WRITE
      - REALIZE AS CONFIRMAÇÕES

---



**Ligando o Raspberry - Primeira configuração**

---

- COLOQUE O CARTÃO DE MEMÓRIA NA ENTRADA DO RASPBERRY

- CONECTE TODOS OS CABOS

  - HDMI (MONITOR)
  - TECLADO (USB 2.0)
  - MOUSE (USB 2.0)
  - WEBCAM (USB 3.0)
  - FONTE DE ALIMENTAÇÃO (ULTIMO CABO A SER LIGADO)

- PRIMEIRO CONTATO COM O SISTEMA OPERACIONAL

  - **ALGUNS DETALHES AO LIGAR PELA PRIMEIRA VEZ**
    1. O SISTEMA OPERACIONAL INICIA SEM NENHUMA CONEXÃO A INTERNET ATIVADA
    2. O SISTEMA OPERACIONAL INICIA DE FORMA AUTOMÁTICA O SOFTWARE COM A CONFIGURAÇÃO DE TRIGGER VIA GPIO DO PRÓPRIO RASPBERRY
    3. O SOFTWARE RODA EM SEGUNDO PLANO, AO INICIAR O RASPBERRY

- CONFIGURANDO REDE ETHERNET / WI-FI

  - ÍCONE CANTO INFERIOR DIREITO (PRÓXIMO AO RELÓGIO)

    - ACESSO A INTERNET COMUM

      - COMUNICAÇÃO VIA WI-FI 

        - TURN ON WI-FI
        - SELECIONE A REDE DESEJADA E CONECTE NA MESMA

      - COMUNICAÇÃO VIA CABO ETHERNET

        - BASTA COLOCAR UM CABO DE REDE COM ACESSO A REDE INTERNET COMUM

          

    - ACESSO A REDE INDUSTRIAL (CONFIGURAÇÃO WLAN0 OU/E ETH0)

      - CLIQUE COM O **BOTÃO DIREITO** SOBRE O ÍCONE DE REDE
        - WIRELESS & WIRED NETWORK SETTINGS
          - **INTERFACE - ETH0**
            - **IPV4 ADDRESS**
              - **INFORME O ENDEREÇO DE IP CONFORME DISPONIBILIDADE NA REDE INDÚSTRIAL (EX: 10.15.32.52)**
            - **ROUTERS**
              - **INFORME O ENDEREÇO DE ROTA CONFORME DISPONIBILDIADE NA REDE INDÚSTRIAL (EX: 10.15.32.1)**
            - **DNS SERVERS E DNS SEARCH**
              - **CONFORME DISPONIBILIDADE DA CERVEJARIA SE NÃO HOUVER, DEIXAR EM BRANCO**
          - **INTERFACE - WLAN0**
            - **IPV4 ADDRESS**
              - **INFORME O ENDEREÇO DE IP CONFORME DISPONIBILIDADE NA REDE INDÚSTRIAL (EX: 10.15.32.52)**
            - **ROUTERS**
              - **INFORME O ENDEREÇO DE ROTA CONFORME DISPONIBILDIADE NA REDE INDÚSTRIAL (EX: 10.15.32.1)**
            - **DNS SERVERS E DNS SEARCH**
              - **CONFORME DISPONIBILIDADE DA CERVEJARIA SE NÃO HOUVER, DEIXAR EM BRANCO**

  - PONTO DE ATENÇÃO !!!

    - **SE FOR UTILIZAR A REDE VIA CABO ETHERNET CERTIFIQUE DE DEIXAR O WI-FI DESLIGADO (TURN OFF)**

  - REINICIE O RASPBERRY PARA APLICAR AS CONFIGURAÇÕES.

---



**Acessando a interface do software**

---

- ABRIR NAVEGADOR DO RASPBERRY
  - CANTO INFERIOR ESQUERDO
  - CLICAR NO NAVEGADOR
    - NA BARRA DE NAVEGAÇÃO INSERIR O SEGUINTE ENDEREÇO
      - http://localhost:5000
- NAVEGANDO NA INTERFACE DO SOFTWARE
  - PAGINA INÍCIAL VOCÊ TERÁ AS SEGUINTES INFORMAÇÕES
    - PRODUÇÃO ATUAL
    - PARÂMETROS ATUAIS
    - STATUS DO SOFTWARE
    - CÂMERA AO VIVO
    - GRAFICO DA PRODUÇÃO ATUAL
    - IMAGENS DA PRODUÇÃO ATUAL
  - PAGINA HISTÓRICO VOCÊ TERÁ AS SEGUINTES INFORMAÇÕES
    - PESQUISAR HISTÓRICO
      - APARECERÃO TODAS A PRODUÇÕES FINALIZADAS COM O CONTA-LA
      - DOWNLOAD DAS IMAGENS PESQUISADAS
    - DADOS DA PRODUÇÃO PESQUISADA
      - GRÁFICOS DA PERDA DE LATA
    - IMAGENS DA PRODUÇÃO PESQUISADA
  - PAGINA CONFIGURAÇÃO VOCÊ TERÁ AS SEGUINTES INFORMAÇÕES
    - STATUS DO SOFTWARE
    - BOTÃO DE HABILITAR EDIÇÃO DAS CONFIGURAÇÕES
    - CÂMERA AO VIVO
    - CONFIGURAÇÃO DO SOFTWARE
      - PRODUTO
      - CÂMERA
      - COMUNICAÇÃO
  - PAGINA SOBRE VOCÊ TERÁ AS SEGUINTES INFORMAÇÕES
    - HISTÓRICO ULTIMAS 10 FALHAS
      - ID DA FALHA
      - DESCRIÇÃO DA FALHA
      - HORA DA FALHA
    - LISTA DE FALHAS
      - TODAS AS FALHAS QUE PODEM ACONTECER COM O SOFTWARE
        - LISTA DE TROUBLESHOOTING

---



**Configuração do produto**

---

- NA ABA CONFIGURAÇÃO CLIQUE NO BOTÃO "AGUARDANDO COLETA" ATÉ MUDAR PARA "MODO CONFIGURAÇÃO" E EM SEGUIDA SELECIONE "PRODUTO"
  - OS INPUTS DE EDIÇÃO SERÃO LIBERADOS
    - INPUT NOME DO PRODUTO
      - DEVE SER O NOME DO PRODUTO QUE A LINHA IRÁ PRODUZIR
    - INPUT QUANTIDADE DE LATAS POR CAMADA
      - DEVE SER UM NÚMERO COM A QUANTIDADE DE LATAS POR CAMADA
    - INPUT QUANTIDADE DE CAMADAS POR PALETE
      - DEVER SER O NÚMERO DE CAMADAS POR PALETE
- SALVAR PRODUTO
  - AO CLICAR O SOFTWARE JÁ EDITA A PRODUÇÃO E INÍCIA COM OS NOVOS PARÂMETROS CONFIGURADOS NESTES CAMPOS

---



**Configuração da câmera**

---

- NA ABA CONFIGURAÇÃO CLIQUE NO BOTÃO "AGUARDANDO COLETA" ATÉ MUDAR PARA "MODO CONFIGURAÇÃO" E EM SEGUIDA SELECIONA "CÂMERA"
  - OS INPUTS DE EDIÇÃO SERÃO LIBERADOS
    - INPUT REDUÇÃO DE RUÍDO CÂMERA
      - DEVE SER UM NÚMERO INTEIRO
      - TEM COMO PRINCIPAL OBJETIVO APLICAR UM EFEITO DE BLUR NA IMAGEM COM A IDEIA DE REDUZIR A QUANTIDADE DE RUÍDO DA IMAGEM
    - INPUT DISTÂNCIA MÍNIMA
      - DEVE SER UM NÚMERO INTEIRO
      - TEM COMO PRINCIPAL OBJETIVO IMPEDIR A IDENTIFICAÇÃO DE CÍRCULOS NA MESMA LATA
      - QUANTO MAIOR FOR O NÚMERO, MAIS DISTANTE OS CÍRCULOS SERÃO DETECTADOS
      - QUANTO MENOR, MAIOR O RISCO DE DETECTAR MAIS DE UMA VEZ A MESMA LATA
    - INPUT DETECÇÃO DE BORDA
      - DEVE SER UM NÚMERO INTEIRO
      - TEM COMO PRINCIPAL OBJETIVO DETECTAR TODOS OS CONTORNOS DAS LATAS
      - QUANTO MAIOR FOR O NÚMERO, MENOS CONTORNOS SERÃO IDENTIFICADO NA IMAGEM
      - QUANTO MENOR FOR O NÚMEOR, MAIS CONTORNOS SERÃO IDENTIFICADO NA IMAGEM
    - INPUT ACUMULADOR DE BORDA
      - DEVE SER UM NÚMERO INTEIRO
      - TEM COMO PRINCIPAL OBJETIVO DETECTAR TODOS OS CIRCULOS NO CONTORNO DA LATA
      - QUANTO MAIOR O NÚMERO, MAIS PERFEITO O CIRCULO DEVE ESTAR
      - QUANTO MENOR O NÚMERO, MAIOR O RISCO DE ENCONTRAR SEMI-CIRCULOS
    - RAIO MÍNIMO
      - DEVE SER UM NÚMERO INTEIRO
      - TEM COMO PRINCIPAL OBJETIVO DETECTAR CIRCULOS COM UM RAIO MÍNIMO, CIRCULOS INFERIOR AO INFORMADO SERÃO DESCONSIDERADO
    - RAIO MÁXIMO
      - DEVE SER UM NÚMERO INTEIRO
      - TEM COMO PRINCIPAL OBJETIVO DETECTAR CIRCULOS COM UM RAIO MÁXIMO, CIRCULOS SUPERIOR AO INFORMADO SERÃO DESCONSIDERADOS
- SALVAR CÂMERA
  - AO CLICAR O SOFTWARE JÁ EDITA A PRODUÇÃO E INÍCIA COM OS NOVOS PARÂMETROS CONFIGURADOS NESTES CAMPOS

---



**Configuração da comunicação**

---

- **O CONTA-LA É COMPATIVEL APENAS COM 3 TIPOS DE CLP**

  - **SIEMENS S7 OU SUPERIOR**
  - **ROCKWELL 5000 OU SUPERIOR**
  - **RASPBERRY PI GPIO**

- NA ABA CONFIGURAÇÃO CLIQUE NO BOTÃO "AGUARDANDO COLETA" ATÉ MUDAR PARA "MODO CONFIGURAÇÃO" E EM SEGUIDA SELECIONA "COMUNICAÇÃO"

  - OS INPUTS DE EDIÇÃO SERÃO LIBERADOS
  - SELECIONE ALGUM TIPO DE CLP **(POR PADRÃO NA PRIMEIRA VEZ, O SOFTWARE INICIA COM GPIO RASPBERRY)**

- **SIEMENS S7 +**

  - PONTOS DE ATENÇÃO QUE DEVEM SER LEVADOS EM CONSIDERAÇÃO PARA O BOM FUNCIONAMENTO DO SOFTWARE

    1. O TRIGGER DE LEITURA DEVERÁ SER UM BIT VERDADEIRO (1)

    2. O TRIGGER DE LEITURA DEVERÁ SE MANTER ATIVO POR PELO MENOS 1 SEGUNDO

       

  - IP DA CPU

    - DEVE SER O ENDEREÇO DE IP DA CPU NA REDE INDÚSTRIAL
    - DEVE SER UM ENDEREÇO DE IP SEPARADOS POR PONTO EX (10.15.32.52)

  - RACK DO PLC

    - DEVE SER UM NÚMERO INTEIRO
    - INFORMAR O RACK EM QUE O CPL ESTÁ

  - SLOT DO PLC

    - DEVE SER UM NÚMERO INTEIRO
    - INFORMR O SLOT EM QUE O CLP ESTÁ

  - NÚMERO DA DB

    - DEVE SER UM NÚMERO INTEIRO
    - INFORMAR O NÚMERO DA DB EM QUE O BIT DE TRIGGER SE ENCONTRA

  - OFFSET DB (ENDEREÇO DE START)

    - DEVE SER UM NÚMERO INTEIRO
    - INFORMAR EM QUE OFFSET O SOFTWARE DEVERÁ INCIAR A VARREDURA DO BIT TRIGGER
      - PADRÃO = 0 (INÍCIO DA DB - EX = DB100.DBD0)

  - TAMANHO DO BYTE

    - DEVE SER UM NÚMERO INTEIRO
    - INFORMAR O TAMANHO DO BYTE DE LEITURA

  - BYTE DE LEITURA

    - DEVE SER UM NÚMERO INTEIRO
    - INFORMAR QUAL É O BYTE DE LEITURA

  - BIT DE LEITA DO BYTE

    - DEVER SER UM NÚMERO INTEIRO
    - INFORMAR QUAL É O BIT DO BYTE DE LEITURA

- **ROCKWELL 5000 +**

  - PONTOS DE ATENÇÃO QUE DEVEM SER LEVADOS EM CONSIDERAÇÃO PARA O BOM FUNCIONAMENTO DO SOFTWARE

    1. O TRIGGER DE LEITURA DEVERÁ SER UM BIT VERDADEIRO (1)

    2. O TRIGGER DE LEITURA DEVERÁ SE MANTER ATIVO POR PELO MENOS 1 SEGUNDO

       

  - IP DA CPU

    - DEVE SER O ENDEREÇO DE IP DA CPU NA REDE INDÚSTRIAL
    - DEVE SER UM ENDEREÇO DE IP SEPARADOS POR PONTO EX (10.15.32.52)

  - TAG DA CPU

    - DEVE SER O ENDEREÇO DA TAG DENTRO DO PLC
      - EX = _0000_Pulse.TriggerCONTALA

- **RASPBERRY PI GPIO**

  - PONTOS DE ATENÇÃO QUE DEVEM SER LEVADOS EM CONSIDERAÇÃO PARA O BOM FUNCIONAMENTO DO SOFTWARE
    1. **AS I/O DO RASPBERRY SÃO LIMITADAS A 3.3V**
    2. **DE FORMA ALGUMA MANDE 24V DIRETO PARA AS ENTRADAS**
    3. **UTILIZE OS 3.3V DA PLACA PARA REALIZAR O TRIGGER VIA GPIO**
    4. **UTILIZE UM RELÉ DE CONTATO SECO PARA REALIZAR O TRIGGER**
  - SELEÇÃO DE GPIO RASPBERRY
    - DEVE SER SELECIONADO UM PINO GPIO PARA REALIZAÇÃO DO TRIGGER
      - NÃO DEVE SER O MESMO SELECIONADO NO NODE-RED PARA FECHAMENTO DE PRODUÇÃO
  - SALVAR CLP
    - **ATENÇÃO, PARA TRIGGER VIA CLP SIEMENS,ROCKWELL, OU GPIO RASPBERRY O SOFTWARE DEVERÁ SER REINICIADO DE FORMA MANUAL**
      - ABRIR O CMD DO RASPBERRY
        - DIGITAR:
          - pidof conta-la
          - sudo kill "número que aparece após digitar o conta-la"
      - IR PARA A ÁREA DE TRABALHO E ABRIR O APLICATIVO "CONTA-LA" OU REINICIAR O RASPBERRY

---

